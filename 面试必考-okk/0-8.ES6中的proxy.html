<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    1、Proxy
    在目标对象之前架设一层拦截，外界对该对象的访问，都必须先通过这层拦截。即可以对外界的访问进行过滤和改写。
    <script>
      var proxy = new Proxy(target, handler);
      //new Proxy()表示生成一个Proxy实例，target参数表示所要拦截的目标对象，handle参数也是一个对象，用来定制拦截行为。
      var object = { proxy: new Proxy(target, handler) };
      //将Proxy对象设置到object.proxy属性，从而可以在object对象上调用
    </script>
    Proxy实例也可以作为其他对象的原型对象。proxy对象是obj对象的原型，obj对象本身没有time属性，根据原型链会在proxy对象上读取属性，导致被拦截。
    <script>
      var proxy = new Proxy(
        {},
        {
          get: function (target, propKey) {
            return 35;
          },
        }
      );
      let obj = Object.create(proxy);
      //Object.create()会创建一个新对象，使用现有对象来提供新创建对象的__proto__。proxy即为新创建对象的原型对象。
      obj.time;
    </script>
    ------------------------------------------------------------------------------------------
    拦截操作
    ------------------------------------------------------------------------------------------
    1、handler.get() 用于拦截对象的读取属性操作。
    <script>
      var p = new Proxy(target, {
        get: function (target, property, receiver) {},
        //target:目标对象
        //property:被获取的属性名
        //receiver:Proxy或者继承Proxy的对象
      });
    </script>
    该方法会拦截目标对象的以下操作： {1、访问属性: proxy[foo]和 proxy.bar
    2、访问原型链上的属性: Object.create(proxy)[foo] 3、Reflect.get()}
    如果违背了以下的约束，proxy会抛出 TypeError:
    如果要访问的目标属性是不可写以及不可配置的，则返回的值必须与该目标属性的值相同。
    如果要访问的目标属性没有配置访问方法，即get方法是undefined的，则返回值必须为undefined。
    ------------------------------------------------------------------------------------------
    实现属性的链式操作
    <script>
      var pipe = function (value) {
        var funcStack = [];
        var oproxy = new Proxy(
          {},
          {
            get: function (pipeObject, fnName) {
              if (fnName === "get") {
                return funcStack.reduce(function (val, fn) {
                  return fn(val);
                }, value);
              }
              funcStack.push(window[fnName]);
              return oproxy;
            },
          }
        );

        return oproxy;
      };

      var double = (n) => n * 2;
      var pow = (n) => n * n;
      var reverseInt = (n) => n.toString().split("").reverse().join("") | 0;

      pipe(3).double.pow.reverseInt.get; // 63
    </script>
  </body>
</html>
